# Complete SAM System - Pure C Implementation Makefile
# Compiles all C modules and creates Python extensions

# Compiler settings
CC = gcc
PYTHON = python3
PYTHON_CONFIG = python3-config

# Include paths for SAM framework components
SAM_INCLUDES = -I./ORGANIZED/UTILS/SAM/SAM -I./ORGANIZED/UTILS/utils/NN/MUZE -I./ORGANIZED/UTILS/utils/NN/NEAT -I./ORGANIZED/UTILS/utils/NN/TRANSFORMER

# Compiler flags
CFLAGS = -Wall -Wextra -O2 -fPIC -std=c99 $(SAM_INCLUDES) $(shell $(PYTHON_CONFIG) --cflags)

# Linker flags - explicit Python linking for ARM64 macOS
PYTHON_LDFLAGS = -L$(shell $(PYTHON_CONFIG) --prefix)/lib -lpython3.11 -lm -lpthread
LDFLAGS = $(PYTHON_LDFLAGS)

# Source files for each module
CONSCIOUSNESS_SRC = consciousness_algorithmic.c
ORCHESTRATOR_SRC = multi_agent_orchestrator_c.c
AGENTS_SRC = specialized_agents_c.c
NEURAL_SRC = neural_network_c.c
WEBSERVER_SRC = sam_web_server_c.c

# Target shared libraries
CONSCIOUSNESS_SO = consciousness_algorithmic.so
ORCHESTRATOR_SO = multi_agent_orchestrator_c.so
AGENTS_SO = specialized_agents_c.so
NEURAL_SO = neural_network_c.so
WEBSERVER_SO = sam_web_server_c.so

# Default target
all: $(CONSCIOUSNESS_SO) $(ORCHESTRATOR_SO) $(AGENTS_SO) $(NEURAL_SO) $(WEBSERVER_SO)
	@echo "âœ… All SAM C modules compiled successfully"

# Consciousness module
$(CONSCIOUSNESS_SO): $(CONSCIOUSNESS_SRC)
	@echo "ðŸ§  Compiling consciousness module..."
	$(CC) $(CFLAGS) -shared $< -o $@ $(LDFLAGS)
	@echo "âœ… Consciousness module ready"

# Multi-agent orchestrator
$(ORCHESTRATOR_SO): $(ORCHESTRATOR_SRC)
	@echo "ðŸ¤– Compiling multi-agent orchestrator..."
	$(CC) $(CFLAGS) -shared $< -o $@ $(LDFLAGS)
	@echo "âœ… Multi-agent orchestrator ready"

# Specialized agents
$(AGENTS_SO): $(AGENTS_SRC)
	@echo "ðŸŽ¯ Compiling specialized agents..."
	$(CC) $(CFLAGS) -shared $< -o $@ $(LDFLAGS)
	@echo "âœ… Specialized agents ready"

# Neural network framework
$(NEURAL_SO): $(NEURAL_SRC)
	@echo "ðŸ§  Compiling neural network framework..."
	$(CC) $(CFLAGS) -shared $< -o $@ $(LDFLAGS)
	@echo "âœ… Neural network framework ready"

# Web server
$(WEBSERVER_SO): $(WEBSERVER_SRC)
	@echo "ðŸ–¥ï¸  Compiling web server..."
	$(CC) $(CFLAGS) -shared $< -o $@ $(LDFLAGS)
	@echo "âœ… Web server ready"

# Clean build artifacts
clean:
	@echo "ðŸ§¹ Cleaning build artifacts..."
	rm -f *.so *.o
	@echo "âœ… Clean completed"

# Test compilation of all modules
test: all
	@echo "ðŸ§ª Testing Python imports..."
	$(PYTHON) -c "import consciousness_algorithmic; print('âœ… Consciousness import OK')"
	$(PYTHON) -c "import multi_agent_orchestrator_c; print('âœ… Orchestrator import OK')"
	$(PYTHON) -c "import specialized_agents_c; print('âœ… Agents import OK')"
	$(PYTHON) -c "import neural_network_c; print('âœ… Neural network import OK')"
	$(PYTHON) -c "import sam_web_server_c; print('âœ… Web server import OK')"
	@echo "âœ… All imports successful"

# Install dependencies (if needed)
deps:
	@echo "ðŸ“¦ Installing Python dependencies..."
	$(PYTHON) -m pip install --upgrade pip
	$(PYTHON) -m pip install numpy torch flask requests beautifulsoup4
	@echo "âœ… Dependencies installed"

# Full system test
system_test: test
	@echo "ðŸš€ Running complete system test..."
	$(PYTHON) complete_sam_system_clean_c.py
	@echo "âœ… System test completed"

# Help
help:
	@echo "SAM Pure C Implementation Build System"
	@echo ""
	@echo "Targets:"
	@echo "  all          - Build all C modules"
	@echo "  clean        - Remove build artifacts"
	@echo "  test         - Test Python imports"
	@echo "  deps         - Install Python dependencies"
	@echo "  system_test  - Run complete system test"
	@echo ""
	@echo "Modules:"
	@echo "  consciousness_algorithmic.so    - Algorithmic consciousness"
	@echo "  multi_agent_orchestrator_c.so   - Multi-agent orchestration"
	@echo "  specialized_agents_c.so         - Specialized agents"
	@echo "  neural_network_c.so             - Neural network framework"
	@echo "  sam_web_server_c.so            - Web server"
	@echo ""
	@echo "Usage: make [target]"

.PHONY: all clean test deps system_test help
